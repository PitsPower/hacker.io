<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8">
        <title>hacker.io</title>
        
        <style>
            * {
                background-color: gray;
                padding: 0;
                margin: 0;
                overflow: hidden;
            }
        </style>
    </head>
    <body>
        <canvas id="game"></canvas>
        
        <script>
            var canvas = document.getElementById("game");
            var ctx = canvas.getContext("2d");
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            ctx.font = "40px Lucida Console";
            ctx.translate(canvas.width/2,canvas.height/2);
            
            var players = [];
            
            function createMachineCode(x,y) {
                var text = "";
                for (var i=0;i<4;i++) {
                    text += ["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"][~~(Math.random()*16)]
                }
                players.push({
                    type: "machine_code",
                    text: text,
                    position: {x:x,y:y},
                    radius: 75,
                    
                    particles: [],
                    
                    speed: 5,
                    accel: .5,
                    friction: .9,
                    velocity: {x:0,y:0}
                });
            }
            
            function drawMachineCode(player,delta) {
                ctx.fillStyle = "#000";
                
                ctx.beginPath();
                ctx.arc(player.position.x,player.position.y,player.radius,0,2*Math.PI);
                ctx.fill();
                
                ctx.fillStyle = "#fff";
                // M is used to get the height because its width is about equal to its height
                ctx.fillText(
                    player.text,
                    player.position.x-(ctx.measureText(player.text).width/2),
                    player.position.y+(ctx.measureText("M").width/2)
                );
                
                for (var i=0;i<player.particles.length;i++) {
                    var particle = player.particles[i];
                    
                    if (particle) {
                        ctx.fillStyle = "rgba(0,255,0,"+particle.opacity+")";
                        particle.opacity -= 0.01*delta;
                        particle.position.x += particle.initialPosition.x/100*delta;
                        particle.position.y += particle.initialPosition.y/100*delta;

                        if (particle.opacity <= 0) player.particles[i] = null;

                        ctx.fillText(
                            particle.text,
                            player.position.x+particle.position.x-(ctx.measureText(particle.text).width/2),
                            player.position.y+particle.position.y+(ctx.measureText("M").width/2)
                        );
                    }
                }
            }
            
            function addParticle(player) {
                var text = +(Math.random()>.5);
                    
                var angle = (Math.random()*Math.PI*2)-(Math.PI);
                
                var xPos = player.radius*Math.cos(angle);
                var yPos = player.radius*Math.sin(angle);
                
                player.particles.push({
                    text: text,
                    position: {x:xPos,y:yPos},
                    initialPosition: {x:xPos,y:yPos},
                    opacity: 1
                });
            }
            
            createMachineCode(0,0);
            
            var keys = {
                LEFT: 65,
                RIGHT: 68,
                UP: 87,
                DOWN: 83
            };
            var keysDown = [];
            document.onkeydown = function(e) {
                keysDown[e.keyCode] = true;
            }
            document.onkeyup = function(e) {
                keysDown[e.keyCode] = false;
            }
            
            var prevTime = performance.now();
            
            function render() {
                requestAnimationFrame(render);
                
                var time = performance.now();
                var delta = (time-prevTime)/17;
                
                var player = players[0];
                
                ctx.translate(player.position.x,player.position.y);
                ctx.clearRect(-canvas.width/2,-canvas.height/2,canvas.width,canvas.height);
                    
                if (keysDown[keys.LEFT]) player.velocity.x -= player.accel;
                if (keysDown[keys.RIGHT]) player.velocity.x += player.accel;
                if (keysDown[keys.UP]) player.velocity.y -= player.accel;
                if (keysDown[keys.DOWN]) player.velocity.y += player.accel;

                if (player.velocity.x>player.speed) player.velocity.x=player.speed;
                if (player.velocity.y>player.speed) player.velocity.y=player.speed;

                player.velocity.x*=player.friction;
                player.velocity.y*=player.friction;

                player.position.x+=player.velocity.x*delta;
                player.position.y+=player.velocity.y*delta;
                
                ctx.translate(-player.position.x,-player.position.y);
                
                ctx.fillStyle = "#fff";
                ctx.fillRect(100,100,200,200);
                
                for (var i=0;i<players.length;i++) {
                    var player = players[i];
                    if (player.type=="machine_code") {
                        drawMachineCode(player,delta);
                    }
                    
                    var particle = Math.random()>.9;
                    if (particle) addParticle(player);
                }
                
                prevTime = time;
            }
            
            render();
        </script>
    </body>
</html>